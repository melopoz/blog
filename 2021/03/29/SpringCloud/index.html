

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/blog/img/favicon.png">
  <link rel="icon" type="image/png" href="/blog/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="Although things are always not as you wish, but effort will be lucy!">
  <meta name="author" content="melopoz">
  <meta name="keywords" content="">
  <title>SpringCloud - 你不喜欢孤独 那就别停下来</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.5.3/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/blog/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.1.2/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />
  



<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/blog/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"melopoz.github.io","root":"/blog/","version":"1.8.5","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"copy_btn":true,"image_zoom":{"enable":true},"lazyload":{"enable":true,"onlypost":false},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}}};
  </script>
  <script  src="/blog/js/utils.js" ></script>
  <script  src="/blog/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/blog/">&nbsp;<strong>Fluid</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner intro-2" id="background" parallax=true
         style="background: url('/blog/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="SpringCloud">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2021-03-29 17:48" pubdate>
        2021年3月29日 下午
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      2.7k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      41
       分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">SpringCloud</h1>
            
            <div class="markdown-body">
              <h2 id="微服务架构要处理的四个问题："><a href="#微服务架构要处理的四个问题：" class="headerlink" title="微服务架构要处理的四个问题："></a>微服务架构要处理的四个问题：</h2><ol>
<li>api</li>
<li>通信：http、RPC</li>
<li>服务注册和发现（解决高可用问题）</li>
<li>熔断机制</li>
</ol>
<h2 id="CAP原则："><a href="#CAP原则：" class="headerlink" title="CAP原则："></a>CAP原则：</h2><ul>
<li>C    consistency    强一致性</li>
<li>A     availability      可用性</li>
<li>P      partition tolerance      分区容错性  （分区相当于对通信的时限要求）</li>
</ul>
<p>只能满足其中两点。P：当系统不能在时限内完成数据一致性，就需要在C和A之间做出选择。</p>
<p>zookeeper：CP</p>
<p>Eureka：AP</p>
<blockquote>
<p>所以Eureka的自我保护机制可以很好地应对网络故障导致很多节点失去联系的情况，不会像zookeeper那样整个集群都不可用了。</p>
</blockquote>
<h2 id="目前的三个解决方案："><a href="#目前的三个解决方案：" class="headerlink" title="目前的三个解决方案："></a>目前的三个解决方案：</h2><ol>
<li><p>Apache Dubbo Zookeeper</p>
<p>api：需要整合第三方 或者自行实现</p>
<p>通信：dubbo通信框架可以使用RPC或HTTP</p>
<p>服务注册：zookeeper</p>
<p>熔断机制：无</p>
</li>
<li><p>Spring Cloud NetFlix</p>
<p>api：网关，zuul组件</p>
<p>通信：Feign  HttpClient     http通信方式，同步，阻塞</p>
<p>服务注册：Eureka</p>
<p>熔断机制：Hystrix</p>
<p>负载均衡：Ribbon</p>
</li>
<li><p>Spring Cloud Alibaba</p>
<p>2019.9开始使用 一站式解决方案</p>
</li>
</ol>
<p>Dubbo是指RPC框架，Spring Cloud是微服务架构的一站式解决方案。本质不同。</p>
<h1 id="Spring-Cloud"><a href="#Spring-Cloud" class="headerlink" title="Spring Cloud"></a>Spring Cloud</h1><p>使用restful的http通信</p>
<h3 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h3><ul>
<li><p>后端api项目(provider)：使用controller提供api。</p>
</li>
<li><p>前端consumer项目：使用RestTemplate发送restful请求，调用api项目提供的服务。</p>
</li>
<li><p>使用Eureka当做服务注册中心。</p>
</li>
</ul>
<h3 id="Eureka-服务注册中心"><a href="#Eureka-服务注册中心" class="headerlink" title="Eureka 服务注册中心"></a>Eureka 服务注册中心</h3><h5 id="两个组件："><a href="#两个组件：" class="headerlink" title="两个组件："></a>两个组件：</h5><blockquote>
<p> Eureka Server 和 Eureka Client</p>
</blockquote>
<ul>
<li><p>server提供服务注册服务，就像zookeeper</p>
</li>
<li><p> client是一个java客户端，有一个内置复杂均衡器(轮询)。 应用启动之后想server发送心跳，server在多个心跳周期中没有收到服务提供者的心跳，就移除该provider。</p>
</li>
</ul>
<h5 id="三个角色："><a href="#三个角色：" class="headerlink" title="三个角色："></a>三个角色：</h5><blockquote>
<p>Eureka Server  Eureka Provider  Eureka Consumer: </p>
</blockquote>
<h5 id="一个EurekaServer项目"><a href="#一个EurekaServer项目" class="headerlink" title="一个EurekaServer项目"></a>一个EurekaServer项目</h5><p>依赖</p>
<pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
       <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
           <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
           <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-eureka-server<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
           <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.4.4.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
       <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
   <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span></code></pre>

<p>启动类</p>
<pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-meta">@EnableEurekaServer</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EurekaServer</span> </span>&#123;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;
        SpringApplication.run(EurekaServer.class, args);
    &#125;
&#125;
</code></pre>

<p>application.yml</p>
<pre><code class="hljs yaml"><span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">9101</span>

<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">application:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">eureka-server</span>

<span class="hljs-attr">eureka:</span>
  <span class="hljs-attr">instance:</span>
    <span class="hljs-attr">hostname:</span> <span class="hljs-string">eureka9101.com</span>
  <span class="hljs-attr">client:</span>
    <span class="hljs-attr">register-with-eureka:</span> <span class="hljs-literal">false</span> <span class="hljs-comment">#不登记 表示自己是注册中心</span>
    <span class="hljs-attr">fetch-registry:</span> <span class="hljs-literal">false</span> <span class="hljs-comment">#不抓取注册中心 自己作为注册中心</span>
    <span class="hljs-attr">service-url:</span>
      <span class="hljs-comment">#单机</span>
      <span class="hljs-comment">#defaultZone: http://$&#123;eureka.instance.hostname&#125;:$&#123;server.port&#125;/eureka #注册服务的地址</span>
      <span class="hljs-comment">#集群 将其他的eureka注册中心写进来</span>
      <span class="hljs-attr">defaultZone:</span> <span class="hljs-string">http://eureka9102.com:9102/eureka,http://eureka9103.com:9103/eureka</span></code></pre>

<h5 id="一个EurekaClient-服务提供者项目-后端api"><a href="#一个EurekaClient-服务提供者项目-后端api" class="headerlink" title="一个EurekaClient-服务提供者项目(后端api)"></a>一个EurekaClient-服务提供者项目(后端api)</h5><blockquote>
<p>​    springboot项目结构</p>
</blockquote>
<p>依赖</p>
<pre><code class="hljs xml"><span class="hljs-comment">&lt;!--boot web starter 版本控制在父pom的dependenciesManager--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>		
<span class="hljs-comment">&lt;!--eureka--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-eureka<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.4.4.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-comment">&lt;!--actuator--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.1.14.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>

<p>启动类</p>
<pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-comment">//...其他注解</span>
<span class="hljs-meta">@EnableEurekaClient</span> <span class="hljs-comment">//eureka client</span>
<span class="hljs-meta">@EnableDiscoveryClient</span> <span class="hljs-comment">//完善注册中心的信息</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ApiApplication</span> </span>&#123;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;
        SpringApplication.run(ApiApplication.class, args);
    &#125;
&#125;</code></pre>

<p>application.yml</p>
<pre><code class="hljs yaml"><span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">9001</span>
<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">application:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">playerapi</span>
<span class="hljs-attr">eureka:</span>
  <span class="hljs-attr">client:</span>
    <span class="hljs-attr">service-url:</span>
      <span class="hljs-attr">defaultZone:</span> <span class="hljs-string">http://eureka9101.com:9100/eureka,http://eureka9102.com:9102/eureka,http://eureka9103.com:9103/eureka</span>
  <span class="hljs-attr">instance:</span>
    <span class="hljs-attr">instance-id:</span> <span class="hljs-string">api</span>

<span class="hljs-comment">#可以在eureka中显示的服务实例的actuator/info中看到 需要spring-boot-starter-actuator依赖</span>
<span class="hljs-attr">info:</span>
  <span class="hljs-attr">api.name:</span> <span class="hljs-string">firstspringcloud-api</span>
  <span class="hljs-attr">api.msg:</span> <span class="hljs-string">this</span> <span class="hljs-string">is</span> <span class="hljs-string">api</span></code></pre>



<h3 id="Feign-使用接口方式调用服务，类似Dubbo"><a href="#Feign-使用接口方式调用服务，类似Dubbo" class="headerlink" title="Feign 使用接口方式调用服务，类似Dubbo"></a>Feign 使用接口方式调用服务，类似Dubbo</h3><p>前端app调用后端api服务的方式：</p>
<ul>
<li><p>使用RestTemplate</p>
<blockquote>
<h5 id="一个前端-服务消费者-项目-boot-web-consumer-使用RestTemplate通信"><a href="#一个前端-服务消费者-项目-boot-web-consumer-使用RestTemplate通信" class="headerlink" title="一个前端(服务消费者)项目(boot web) consumer 使用RestTemplate通信"></a>一个前端(服务消费者)项目(boot web) consumer 使用RestTemplate通信</h5><p>依赖</p>
<pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.melopoz<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-comment">&lt;!--Ribbon--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-ribbon<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.4.4.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-comment">&lt;!--eureka--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-eureka<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.4.4.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span></code></pre>

<p>启动类</p>
<pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-meta">@EnableEurekaClient</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FrontApplication1</span> </span>&#123;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;
        SpringApplication.run(FrontApplication1.class, args);
    &#125;
&#125;
</code></pre>

<p>config</p>
<pre><code class="hljs java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Beans</span> </span>&#123;
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-meta">@LoadBalanced</span><span class="hljs-comment">//负载均衡的restTemplate</span>
    <span class="hljs-function">RestTemplate <span class="hljs-title">restTemplate</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RestTemplate();
    &#125;
&#125;</code></pre>

<p>controller</p>
<pre><code class="hljs java"><span class="hljs-comment">// PLAYERAPI 是Eureka中的服务的Application的名称  </span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String baseUrl = <span class="hljs-string">&quot;http://PLAYERAPI/player&quot;</span>;

   <span class="hljs-meta">@Autowired</span>
   <span class="hljs-keyword">private</span> RestTemplate restTemplate;

   <span class="hljs-meta">@GetMapping(&quot;/list&quot;)</span>
   <span class="hljs-function"><span class="hljs-keyword">public</span> List <span class="hljs-title">list</span><span class="hljs-params">()</span> </span>&#123;
       <span class="hljs-keyword">return</span> restTemplate.getForObject(baseUrl + <span class="hljs-string">&quot;/list&quot;</span>, List.class);
   &#125;</code></pre>

<p>application.yml</p>
<pre><code class="hljs yaml"><span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">10001</span>
<span class="hljs-attr">eureka:</span>
  <span class="hljs-attr">client:</span>
    <span class="hljs-attr">register-with-eureka:</span> <span class="hljs-literal">false</span> <span class="hljs-comment">#不向eureka注册自己</span>
    <span class="hljs-attr">service-url:</span>
      <span class="hljs-attr">defaultZone:</span> <span class="hljs-string">http://eureka9101.com:9101/eureka,http://eureka9102.com:9102/eureka,http://eureka9103.com:9103/eureka</span></code></pre>


</blockquote>
</li>
<li><p>在commons中做公共service包，使用Feign进行服务注册</p>
<blockquote>
<p>commons项目 依赖</p>
<pre><code class="hljs xml"><span class="hljs-comment">&lt;!--feign--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-feign<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.4.4.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>

<p>commons项目 service包</p>
<pre><code class="hljs java"><span class="hljs-meta">@Component</span>
<span class="hljs-meta">@FeignClient(value = &quot;PLAYERAPI&quot;, fallbackFactory = FrontPlayerServiceFallbackFactory.class)</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">FrontPlayerService</span> </span>&#123;
    <span class="hljs-meta">@GetMapping(&quot;/player/list&quot;)</span>
    <span class="hljs-function">List&lt;Player&gt; <span class="hljs-title">list</span><span class="hljs-params">()</span></span>;
    <span class="hljs-meta">@GetMapping(&quot;/player/&#123;id&#125;&quot;)</span><span class="hljs-comment">//在Service中必须有value=，不然报错</span>
    <span class="hljs-function">Player <span class="hljs-title">getById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(value = &quot;id&quot;)</span> Long id)</span></span>;
    <span class="hljs-meta">@GetMapping(&quot;/player/test&quot;)</span>
    <span class="hljs-function">Player <span class="hljs-title">test</span><span class="hljs-params">()</span></span>;
&#125;</code></pre>

<p>feignFront项目 依赖</p>
<pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.melopoz<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-comment">&lt;!--eureka--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-eureka<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.4.4.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-comment">&lt;!--feign 可以没有 commons已经引入--&gt;</span>
    <span class="hljs-comment">&lt;!-- &lt;dependency&gt;</span>
<span class="hljs-comment">        &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span>
<span class="hljs-comment">        &lt;artifactId&gt;spring-cloud-starter-feign&lt;/artifactId&gt;</span>
<span class="hljs-comment">        &lt;version&gt;1.4.4.RELEASE&lt;/version&gt;</span>
<span class="hljs-comment">    &lt;/dependency&gt; --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span></code></pre>

<p>controller</p>
<pre><code class="hljs java"><span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping(&quot;/player&quot;)</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PlayerController</span> </span>&#123;
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> FrontPlayerService frontPlayerService; <span class="hljs-comment">//直接注入commons项目中的service</span>
    <span class="hljs-meta">@GetMapping(&quot;/list&quot;)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> List <span class="hljs-title">list</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> frontPlayerService.list();
    &#125;
    <span class="hljs-meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span><span class="hljs-comment">//@PathVariable在Service接口中必须有value=</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Player <span class="hljs-title">getById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id)</span> </span>&#123;
        <span class="hljs-keyword">return</span> frontPlayerService.getById(id);
    &#125;
    <span class="hljs-meta">@GetMapping(&quot;/test&quot;)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Player <span class="hljs-title">test</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> frontPlayerService.test();
    &#125;
&#125;</code></pre>
</blockquote>
</li>
</ul>
<h3 id="Ribbon-负载均衡"><a href="#Ribbon-负载均衡" class="headerlink" title="Ribbon 负载均衡"></a>Ribbon 负载均衡</h3><blockquote>
<p>在前端项目(consumer)实现负载均衡</p>
</blockquote>
<pre><code class="hljs java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Beans</span> </span>&#123;
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-meta">@LoadBalanced</span><span class="hljs-comment">//负载均衡的restTemplate</span>
    <span class="hljs-function">RestTemplate <span class="hljs-title">restTemplate</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RestTemplate();
    &#125;
&#125;</code></pre>

<p>轮询 随机 权重。。也可以自定义实现负载均衡算法</p>
<h3 id="Hystrix-服务熔断-服务降级"><a href="#Hystrix-服务熔断-服务降级" class="headerlink" title="Hystrix 服务熔断 服务降级"></a>Hystrix 服务熔断 服务降级</h3><blockquote>
<ul>
<li>服务熔断：如果后端api中的某个服务在相应的时候超时、抛异常了。就返回另一个备用方法。是为了安全</li>
<li>服务降级：如果某个时间段要调用太多A服务，几乎不调用B服务。就直接使用B服务备用方法的返回值，不让b服务真正运行，从而减小服务器的负载，让服务器更有性能去运行a服务。是为了效率</li>
</ul>
<p>备用方法：返回当前服务不可用的信息。</p>
</blockquote>
<p>后端实现服务熔断的三种方法：</p>
<ol>
<li>超时熔断</li>
<li>线程池隔离</li>
<li>信号量隔离</li>
</ol>
<h5 id="demo"><a href="#demo" class="headerlink" title="demo:"></a>demo:</h5><ul>
<li><p>使用RestTemplate调用，并在后端模拟服务故障，实现<strong>服务熔断</strong></p>
<blockquote>
<p>在后端提供api服务的项目的controller层的接口方法中如果有异常，就调用熔断的方法(返回null格式的数据)</p>
<p>启动类</p>
<pre><code class="hljs java"><span class="hljs-meta">@EnableCircuitBreaker</span><span class="hljs-comment">//hystix  开启熔断机制</span></code></pre>

<p>controller</p>
<pre><code class="hljs java">xxxController &#123;
   	<span class="hljs-comment">// 模拟服务调用异常，熔断</span>
    <span class="hljs-meta">@HystrixCommand(fallbackMethod = &quot;hystrixGetById&quot;)</span> <span class="hljs-comment">// 熔断后调用的方法</span>
    <span class="hljs-meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Player <span class="hljs-title">getById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id)</span> </span>&#123;
        Player player = playerService.getById(id);
        <span class="hljs-keyword">if</span> (player == <span class="hljs-keyword">null</span>) &#123;
            System.out.println(<span class="hljs-string">&quot;throw exception...&quot;</span>);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">&quot;不存在id为&quot;</span> + id + <span class="hljs-string">&quot;的Player数据&quot;</span>);
        &#125;
        <span class="hljs-keyword">return</span> player;
    &#125;
    <span class="hljs-function"><span class="hljs-keyword">public</span> Player <span class="hljs-title">hystrixGetById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id)</span> </span>&#123;
        System.out.println(<span class="hljs-string">&quot;hystrixGetById()...&quot;</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Player().setId(id);
    &#125;
    <span class="hljs-comment">// ...</span>
    <span class="hljs-comment">//模拟服务调用超时，降级</span>
	<span class="hljs-comment">//超时降级配置</span>
	<span class="hljs-meta">@HystrixCommand(</span>
<span class="hljs-meta">      commandKey = &quot;list&quot;,</span>
<span class="hljs-meta">      commandProperties = &#123;</span>
<span class="hljs-meta">       @HystrixProperty(name = &quot;execution.timeout.enabled&quot;,value = &quot;true&quot;),</span>
<span class="hljs-meta">       @HystrixProperty(name = &quot;execution.isolation.thread.timeoutInMilliseconds&quot;,</span>
<span class="hljs-meta">                    	value = &quot;2000&quot;),</span>
<span class="hljs-meta">      &#125;,</span>
<span class="hljs-meta">      fallbackMethod = &quot;listFallbackMethod4Timeout&quot;</span>
<span class="hljs-meta">    )</span>
    <span class="hljs-meta">@GetMapping(&quot;/list&quot;)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Player&gt; <span class="hljs-title">list</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">try</span> &#123;
            <span class="hljs-keyword">int</span> ms = <span class="hljs-keyword">new</span> Random().nextInt(<span class="hljs-number">5</span>);
            System.out.println(<span class="hljs-string">&quot;休眠&quot;</span> + ms + <span class="hljs-string">&quot;s&quot;</span>);
            Thread.sleep(ms * <span class="hljs-number">1000</span>);
        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;
            e.printStackTrace();
        &#125;
        <span class="hljs-keyword">return</span> playerService.list();
    &#125;
    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Player&gt; <span class="hljs-title">listFallbackMethod4Timeout</span><span class="hljs-params">()</span> </span>&#123;
        System.out.println(<span class="hljs-string">&quot;listFallbackMethod4Timeout()...list调用超时了&quot;</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ArrayList&lt;Player&gt;();
    &#125;
&#125;</code></pre>
</blockquote>
</li>
<li><p>使用feign接口方式调用服务，并在前端实现<strong>服务降级</strong></p>
<blockquote>
<p>使用Feign的接口方式调用的时候，在service中加入FallbackFactory，create()方法返回新的service接口的实例，实现服务降级</p>
<p>在commons项目中</p>
<p>service.xxxService</p>
<pre><code class="hljs java"><span class="hljs-meta">@Component</span>
<span class="hljs-meta">@FeignClient(value = &quot;PLAYERAPI&quot;, </span>
<span class="hljs-meta">             // 加入fallback处理</span>
<span class="hljs-meta">             fallbackFactory = FrontPlayerServiceFallbackFactory.class)</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">FrontPlayerService</span> </span>&#123;

    <span class="hljs-meta">@GetMapping(&quot;/player/list&quot;)</span>
    <span class="hljs-function">List&lt;Player&gt; <span class="hljs-title">list</span><span class="hljs-params">()</span></span>;

    <span class="hljs-meta">@GetMapping(&quot;/player/&#123;id&#125;&quot;)</span><span class="hljs-comment">//在Service中必须有value=，不然报错</span>
    <span class="hljs-function">Player <span class="hljs-title">getById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(value = &quot;id&quot;)</span> Long id)</span></span>;

    <span class="hljs-meta">@GetMapping(&quot;/player/test&quot;)</span>
    <span class="hljs-function">Player <span class="hljs-title">test</span><span class="hljs-params">()</span></span>;
&#125;</code></pre>

<p>config.fallbackFactory</p>
<pre><code class="hljs java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FrontPlayerServiceFallbackFactory</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">FallbackFactory</span> </span>&#123;
    <span class="hljs-function"><span class="hljs-keyword">public</span> FrontPlayerService <span class="hljs-title">create</span><span class="hljs-params">(Throwable throwable)</span> </span>&#123;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> FrontPlayerService() &#123;
            <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Player&gt; <span class="hljs-title">list</span><span class="hljs-params">()</span> </span>&#123;
                System.out.println(<span class="hljs-string">&quot;服务降级...list()...&quot;</span>);
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ArrayList&lt;Player&gt;();
            &#125;

            <span class="hljs-function"><span class="hljs-keyword">public</span> Player <span class="hljs-title">getById</span><span class="hljs-params">(Long id)</span> </span>&#123;
                System.out.println(<span class="hljs-string">&quot;服务降级...getById()...&quot;</span>);
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Player().setId(id);
            &#125;

            <span class="hljs-function"><span class="hljs-keyword">public</span> Player <span class="hljs-title">test</span><span class="hljs-params">()</span> </span>&#123;
                System.out.println(<span class="hljs-string">&quot;服务降级...test()...&quot;</span>);
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Player();
            &#125;
        &#125;;
    &#125;
&#125;</code></pre>

<p>application.yml</p>
<pre><code class="hljs yml"><span class="hljs-attr">feign:</span>
  <span class="hljs-attr">hystrix:</span>
    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span> <span class="hljs-comment">#开启服务降级</span></code></pre>
</blockquote>
</li>
</ul>
<h3 id="Dashboard-监控"><a href="#Dashboard-监控" class="headerlink" title="Dashboard 监控"></a>Dashboard 监控</h3><ol>
<li><p>导入依赖</p>
<pre><code class="hljs xml"><span class="hljs-comment">&lt;!--consumer项目依赖加--&gt;</span>
<span class="hljs-comment">&lt;!--hystrix dashboard--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-hystrix-dashboard<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.4.4.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>

<p>provider项目需要有</p>
<pre><code class="hljs xml"><span class="hljs-comment">&lt;!--actuator--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.1.14.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>

<p>给要被监控的api项目的启动类添加servletBean</p>
<p><strong>并且只能对有熔断机制的api进行监控</strong></p>
<pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-meta">@EnableTransactionManagement</span>
<span class="hljs-meta">@MapperScan(&quot;com.melopoz.mapper&quot;)</span>
<span class="hljs-meta">@EnableEurekaClient</span>
<span class="hljs-meta">@EnableDiscoveryClient</span>
<span class="hljs-meta">@EnableCircuitBreaker</span><span class="hljs-comment">//hystix  开启熔断机制</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HystrixApiApplication</span> </span>&#123;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;
        SpringApplication.run(HystrixApiApplication.class, args);
    &#125;

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> ServletRegistrationBean <span class="hljs-title">hystrixMetricsStreamServlet</span><span class="hljs-params">()</span> </span>&#123;
        ServletRegistrationBean registrationBean = <span class="hljs-keyword">new</span> ServletRegistrationBean(<span class="hljs-keyword">new</span> HystrixMetricsStreamServlet());
        registrationBean.addUrlMappings(<span class="hljs-string">&quot;/hystrix.stream&quot;</span>);
        <span class="hljs-keyword">return</span> registrationBean;
    &#125;
&#125;
</code></pre>


</li>
<li><p>创建启动类</p>
<pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-meta">@EnableHystrixDashboard</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DashBordApplication</span> </span>&#123;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;
        SpringApplication.run(DashBordApplication.class, args);
    &#125;
&#125;</code></pre>
</li>
<li><p>application.yml</p>
<pre><code class="hljs yaml"><span class="hljs-attr">server:</span> 
  <span class="hljs-attr">port:</span> <span class="hljs-number">9999</span></code></pre>

<p>访问<a target="_blank" rel="noopener" href="http://localhost:9999/hystrix">http://localhost:9999/hystrix</a></p>
</li>
</ol>
<h3 id="Gateway-网关"><a href="#Gateway-网关" class="headerlink" title="Gateway 网关"></a>Gateway 网关</h3><p>分发请求到提供服务的api</p>
<ol>
<li><p>依赖</p>
<pre><code class="hljs xml"><span class="hljs-comment">&lt;!--dashboard依赖 加--&gt;</span>
<span class="hljs-comment">&lt;!--zuul--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-zuul<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.4.4.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</li>
<li><p>启动类</p>
<pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-meta">@EnableZuulProxy</span> <span class="hljs-comment">//使用zuul网关</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ZuulGatewayApplication</span> </span>&#123;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;
        SpringApplication.run(ZuulGatewayApplication.class, args);
    &#125;
&#125;
</code></pre>
</li>
<li><p>application.yml</p>
<pre><code class="hljs yaml"><span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">9090</span>

<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">application:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">zuul-gateway</span>

<span class="hljs-attr">eureka:</span>
  <span class="hljs-attr">client:</span>
    <span class="hljs-attr">service-url:</span>
      <span class="hljs-attr">defaultZone:</span> <span class="hljs-string">http://eureka9101.com:9101/eureka,http://eureka9102.com:9102/eureka,http://eureka9103.com:9103/eureka</span>
  <span class="hljs-attr">instance:</span>
    <span class="hljs-attr">instance-id:</span> <span class="hljs-string">zuul-gateway</span>
    <span class="hljs-attr">prefer-ip-address:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># 显示服务的ip</span>

<span class="hljs-attr">zuul:</span>
  <span class="hljs-attr">routes:</span> <span class="hljs-comment"># 一个map 自定义</span>
    <span class="hljs-attr">playerApi.serverId:</span> <span class="hljs-string">player</span>
    <span class="hljs-attr">playerApi.path:</span> <span class="hljs-string">/player/**</span>
  <span class="hljs-attr">ignored-services:</span> <span class="hljs-string">playerapi</span> <span class="hljs-comment">#隐藏 不可用这个访问</span>
  <span class="hljs-attr">prefix:</span> <span class="hljs-string">/mp</span>

<span class="hljs-attr">info:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">firstspringcloud-zuul</span> <span class="hljs-string">gateway</span>
  <span class="hljs-attr">msg:</span> <span class="hljs-string">this</span> <span class="hljs-string">is</span> <span class="hljs-string">zuul-gateway</span>
</code></pre>



</li>
</ol>
<h3 id="Spring-Cloud-Config"><a href="#Spring-Cloud-Config" class="headerlink" title="Spring Cloud Config"></a>Spring Cloud Config</h3><p>使用git统一配置项目的config文件。</p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/blog/categories/%E5%88%86%E5%B8%83%E5%BC%8F/">分布式</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/blog/tags/%E5%88%86%E5%B8%83%E5%BC%8F/">分布式</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！</p>
              
              
                <div class="post-prevnext row">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/blog/2021/03/29/%E6%AD%BB%E9%94%81/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">死锁</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/blog/2021/03/29/redis/">
                        <span class="hidden-mobile">Redis</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  

  

  
</footer>

<!-- SCRIPTS -->

  <script  src="https://cdn.staticfile.org/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.staticfile.org/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":200})
    NProgress.start()
    document.addEventListener('DOMContentLoaded', function() {
      window.NProgress && window.NProgress.inc();
    })
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.staticfile.org/jquery/3.5.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.5.3/js/bootstrap.min.js" ></script>
<script  src="/blog/js/debouncer.js" ></script>
<script  src="/blog/js/events.js" ></script>
<script  src="/blog/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/blog/js/lazyload.js" ></script>
  



  



  <script  src="https://cdn.staticfile.org/tocbot/4.12.0/tocbot.min.js" ></script>



  <script  src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.staticfile.org/anchor-js/4.3.0/anchor.min.js" ></script>



  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>





  <script  src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>



  <script  src="/blog/js/local-search.js" ></script>
  <script>
    (function () {
      var path = "/blog/local-search.xml";
      var inputArea = document.querySelector("#local-search-input");
      inputArea.onclick = function () {
        searchFunc(path, 'local-search-input', 'local-search-result');
        this.onclick = null
      }
    })()
  </script>















<!-- 主题的启动项 保持在最底部 -->
<script  src="/blog/js/boot.js" ></script>



</body>
</html>
